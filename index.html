<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblical Lifespans Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .chart-container { position: relative; height: 800px; margin: 40px 0; }
        h1, h2 { text-align: center; }
        #timeline-chart { background-color: #f9f9f9; }
        #scatter-chart { background-color: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Biblical Lifespans: All Explicit and Calculated Ages at Death</h1>
    <p>Generated by Grok.</p>
    
    <div class="chart-container">
        <canvas id="timeline-chart"></canvas>
    </div>
    
    <div class="chart-container">
        <canvas id="scatter-chart"></canvas>
    </div>

    <script>
        // Register plugins with checks
        if (typeof ChartDataLabels !== 'undefined') {
            Chart.register(ChartDataLabels);
        }
        if (typeof ChartZoom !== 'undefined') {
            Chart.register(ChartZoom);
        }

        // Data remains the same
        const lifespanData = [
            { name: "Adam", birth: 0, death: 930, ref: "Gen 5:5", order: 1 },
            { name: "Seth", birth: 130, death: 1042, ref: "Gen 5:8", order: 2 },
            { name: "Enosh", birth: 235, death: 1140, ref: "Gen 5:11", order: 3 },
            { name: "Kenan", birth: 325, death: 1235, ref: "Gen 5:14", order: 4 },
            { name: "Mahalalel", birth: 395, death: 1290, ref: "Gen 5:17", order: 5 },
            { name: "Jared", birth: 460, death: 1422, ref: "Gen 5:20", order: 6 },
            { name: "Enoch", birth: 622, death: 987, ref: "Gen 5:23", order: 7 },
            { name: "Methuselah", birth: 687, death: 1656, ref: "Gen 5:27", order: 8 },
            { name: "Lamech", birth: 874, death: 1651, ref: "Gen 5:31", order: 9 },
            { name: "Noah", birth: 1056, death: 2006, ref: "Gen 9:29", order: 10 },
            { name: "Shem", birth: 1558, death: 2158, ref: "Gen 11:11", order: 11 },
            { name: "Arphaxad", birth: 1658, death: 2096, ref: "Gen 11:13", order: 12 },
            { name: "Shelah", birth: 1693, death: 2126, ref: "Gen 11:15", order: 13 },
            { name: "Eber", birth: 1723, death: 2187, ref: "Gen 11:17", order: 14 },
            { name: "Peleg", birth: 1757, death: 1996, ref: "Gen 11:19", order: 15 },
            { name: "Reu", birth: 1787, death: 2026, ref: "Gen 11:21", order: 16 },
            { name: "Serug", birth: 1819, death: 2049, ref: "Gen 11:23", order: 17 },
            { name: "Nahor", birth: 1849, death: 1997, ref: "Gen 11:25", order: 18 },
            { name: "Terah", birth: 1878, death: 2083, ref: "Gen 11:32", order: 19 },
            { name: "Sarah", birth: 2018, death: 2145, ref: "Gen 23:1", order: 20 },
            { name: "Abraham", birth: 2008, death: 2183, ref: "Gen 25:7", order: 21 },
            { name: "Ishmael", birth: 2094, death: 2231, ref: "Gen 25:17", order: 22 },
            { name: "Isaac", birth: 2108, death: 2288, ref: "Gen 35:28", order: 23 },
            { name: "Jacob", birth: 2168, death: 2315, ref: "Gen 47:28", order: 24 },
            { name: "Joseph", birth: 2259, death: 2369, ref: "Gen 50:26", order: 25 },
            { name: "Aaron", birth: 2430, death: 2553, ref: "Num 33:39", order: 26 },
            { name: "Moses", birth: 2433, death: 2553, ref: "Deut 34:7", order: 27 },
            { name: "David", birth: 2964, death: 3034, ref: "2 Sam 5:4-5 (calculated 70)", order: 28 },
            { name: "Rehoboam", birth: 3033, death: 3092, ref: "1 Ki 14:21; 11:42 (calculated 58)", order: 29 },
            { name: "Jehoshaphat", birth: 3100, death: 3160, ref: "2 Chron 20:31 (calculated 60)", order: 30 },
            { name: "Joash", birth: 3137, death: 3184, ref: "2 Chron 24:1 (calculated 47)", order: 31 },
            { name: "Amaziah", birth: 3167, death: 3221, ref: "2 Chron 25:1 (calculated 54)", order: 32 },
            { name: "Uzziah", birth: 3198, death: 3266, ref: "2 Ki 15:2 (calculated 68)", order: 33 },
            { name: "Hezekiah", birth: 3254, death: 3308, ref: "2 Ki 18:2 (calculated 54)", order: 34 },
            { name: "Manasseh", birth: 3281, death: 3348, ref: "2 Chron 33:1 (calculated 67)", order: 35 },
            { name: "Josiah", birth: 3343, death: 3382, ref: "2 Chron 34:1 (calculated 39)", order: 36 },
            { name: "Jehoiakim", birth: 3370, death: 3406, ref: "2 Ki 23:36 (calculated 36)", order: 37 },
            { name: "Jehoiada", birth: 3067, death: 3197, ref: "2 Chron 24:15 (explicit 130)", order: 38 }
        ];

        // Extended Colors
        const colors = ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40", "#C9CBCF", "#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40", "#FF6384", "#C9CBCF", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40", "#FF6384", "#C9CBCF", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40", "#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40", "#FF6384", "#C9CBCF", "#36A2EB", "#FFCE56", "#4BC0C0"];

        // Function to update label font size based on zoom (safe getZoom check)
        function updateLabelSize(chart) {
            try {
                if (typeof chart.getZoom !== 'function') return; // Skip if plugin not loaded
                const zoomX = chart.getZoom().x || 1;
                const zoomY = chart.getZoom().y || 1;
                const zoomLevel = Math.sqrt(zoomX * zoomY);
                const newSize = Math.max(8, 10 * zoomLevel);
                if (chart.options.plugins.datalabels && chart.options.plugins.datalabels.font.size !== newSize) {
                    chart.options.plugins.datalabels.font.size = newSize;
                    chart.update('none');
                }
            } catch (e) {
                console.log('Zoom update error:', e);
            }
        }

        // Timeline Chart
        const timelineCtx = document.getElementById('timeline-chart').getContext('2d');
        const timelineChart = new Chart(timelineCtx, {
            type: 'line',
            data: {
                datasets: lifespanData.map((person, index) => ({
                    label: person.name,
                    data: [
                        { x: person.birth, y: index, name: person.name },
                        { x: person.death, y: index, name: person.name }
                    ],
                    showLine: true,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length],
                    pointBackgroundColor: colors[index % colors.length],
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    fill: false,
                    tension: 0,
                    borderWidth: 2
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        title: { display: true, text: 'Year AM (from Creation)' },
                        min: 0,
                        max: 3500
                    },
                    y: {
                        type: 'linear',
                        min: -0.5,
                        max: lifespanData.length - 0.5,
                        title: { display: true, text: 'Biblical Figures (ordered by birth year)' },
                        ticks: {
                            callback: function(value) {
                                return lifespanData[Math.round(value)]?.name || '';
                            }
                        }
                    }
                },
                plugins: {
                    datalabels: {
                        display: function(context) {
                            return context.dataIndex === 0;
                        },
                        anchor: 'end',
                        align: 'left',
                        formatter: function(value, context) {
                            return context.dataset.label;
                        },
                        font: { size: 10 },
                        color: 'black'
                    },
                    zoom: {
                        zoom: { 
                            wheel: { enabled: false },
                            pinch: { enabled: true }, 
                            mode: 'xy',
                            limits: {
                                x: { min: 1, max: 20 },
                                y: { min: 1, max: 20 }
                            },
                            onZoomComplete: function({chart}) {
                                updateLabelSize(chart);
                            }
                        },
                        pan: { enabled: true, mode: 'xy' }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const person = lifespanData[context.datasetIndex];
                                const isBirth = context.parsed.x === person.birth;
                                const event = isBirth ? 'Birth' : 'Death';
                                const year = context.parsed.x;
                                return `${person.name}: ${event} in ${year} AM (${person.ref})`;
                            }
                        }
                    }
                },
                interaction: { mode: 'nearest', intersect: false }
            }
        });

        updateLabelSize(timelineChart);

        // Scatter Chart
        const scatterCtx = document.getElementById('scatter-chart').getContext('2d');
        const scatterDataPoints = lifespanData.map((person, index) => ({
            x: person.death,
            y: person.death - person.birth,
            name: person.name,
            age: person.death - person.birth,
            ref: person.ref,
            order: person.order
        }));

        const scatterChart = new Chart(scatterCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Lifespans',
                    data: scatterDataPoints,
                    backgroundColor: colors.slice(0, lifespanData.length),
                    borderColor: colors.slice(0, lifespanData.length),
                    pointRadius: 5,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        title: { display: true, text: 'Death Year AM' },
                        min: 900,
                        max: 3500
                    },
                    y: {
                        type: 'linear',
                        title: { display: true, text: 'Age at Death (years)' },
                        min: 0,
                        max: 1000
                    }
                },
                plugins: {
                    datalabels: {
                        display: true,
                        anchor: 'end',
                        align: 'top',
                        formatter: function(value, context) {
                            return lifespanData[context.dataIndex].name || '';
                        },
                        font: { size: 10 },
                        color: 'black',
                        offset: 4
                    },
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const point = context.raw;
                                return `${point.name} (Order ${point.order}): ${point.age} years (${point.ref})`;
                            }
                        }
                    },
                    zoom: {
                        zoom: { 
                            wheel: { enabled: false },
                            pinch: { enabled: true }, 
                            mode: 'xy',
                            limits: {
                                x: { min: 1, max: 20 },
                                y: { min: 1, max: 20 }
                            },
                            onZoomComplete: function({chart}) {
                                updateLabelSize(chart);
                            }
                        },
                        pan: { enabled: true, mode: 'xy' }
                    }
                },
                interaction: { mode: 'nearest', intersect: false }
            }
        });

        updateLabelSize(scatterChart);
    </script>
</body>
</html>
